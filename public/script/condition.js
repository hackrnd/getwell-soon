var conditions = ["Abdominal obesity","Abducens nerve palsy (VIth cranial nerve)","Acetaminophen poisoning","Achalasia","Acne","Acquired Immunodeficiency syndrome (AIDS), HIV infection","Acromegaly","Acute anticholinergic syndrome","Acute bronchitis","Acute cholinergic syndrome","Acute hypnotic poisoning, intoxication","Acute interstitial nephritis","Acute liver failure","Acute lymphoblastic leukemia (ALL)","Acute mastoiditis","Acute myeloid leukemia (AML)","Acute opioid (morphine, heroin) poisoning, intoxication","Acute pancreatitis","Acute porphyria","Acute rheumatic fever","Acute sinusitis","Acute stimulant (amphetamine, cocaine) overdose","Acute thyroiditis","Adjustment disorder","Adnexitis","Adrenal insufficiency (Addison's disease)","African trypanosomiasis","Agoraphobia","Alcohol withdrawal syndrome","Alcoholic liver disease","Alcoholism","Allergic conjunctivitis","Allergic rhinitis","Alzheimer's disease","American trypanosomiasis (Chagas disease)","Amoebiasis","Amyloidosis","Amyotrophic lateral sclerosis (ALS)","Anal cancer","Anal fissure","Ancylostomiasis (anchylostomiasis, ankylostomiasis, necatoriasis, hookworm disease)","Anemia","Anemia of chronic disease (ACD)","Ankle osteoarthritis","Ankylosing spondylitis, Bechterew's disease","Anorexia","Antiphospholipid syndrome (APS, Hughes syndrome)","Anxiety disorder with panic attacks","Aplastic anemia","Appendicitis","Ascariasis","Asthma","Atherogenic hyperlipidemia","Atopic dermatitis (AD), Eczema","Atrial fibrillation","Attention deficit hyperactivity disorder (ADHD)","Autoimmune gastritis","Autoimmune hepatitis (AIH)","Autoimmune polyendocrine syndrome type 1 (APS-1)","Autoimmune polyendocrine syndrome type 2 (Schmidt's syndrome)","Autoimmune polyendocrine syndrome type 3","Babesiosis","Bacterial meningitis","Balanoposthitis","Behçet's disease","Beta-thalassemia","Bilateral frontal lobe damage","Bilateral temporal lobe damage","Bipolar disorder","Biventricular heart failure","Bladder cancer","Bladder infection","Bleeding peptic ulcer","Borreliosis (Lyme disease, Lyme borreliosis)","Botulism","Breast cancer","Brucellosis","Budd-Chiari syndrome","Bulimia","Cannabinoid use","Carbon monoxide poisoning","Carcinoid syndrome","Carotid artery dissection","Carotid sinus syndrome","Carpal tunnel syndrome","Cat-scratch disease (CSD)","Cataract","Cavernous sinus thrombosis (CST)","Celiac disease","Cerebellar stroke","Cerebellar tumor (medulloblastoma)","Cerebellopontine angle syndrome","Cerebral edema","Cerebral stroke (Cerebrovascular accident (CVA))","Cervicitis","Chalazion","Chicken pox","Chinese restaurant syndrome","Cholecystitis","Choledocholisthiasis (gallstones, biliary colic)","Cholera","Choriocarcinoma","Chronic cannabinoid use","Chronic eosinophilic leukemia (CEL) and Idiopathic eosinophilia","Chronic interstitial nephritis","Chronic intestinal ischemia","Chronic lower limb ischemia","Chronic lymphocytic leukemia (CLL)","Chronic myelogenous leukemia (CML)","Chronic obstructive jaundice","Chronic obstructive pulmonary disease (COPD)","Chronic pancreatitis","Chronic renal failure","Chronic sinusitis","Chronic venous insufficiency","Churg-Strauss syndrome (eosinophilic granulomatosis with polyangiitis)","Cirrhosis","Cluster headaches","Colon cancer (colorectal cancer)","Common cold","Conjunctivitis","Conn's syndrome, primary hyperaldosteronism","Corneal abrasion","Corneal ulceration","Corticotropin releasing pituitary adenoma","Crohn's disease","Cushing's syndrome","Cysticercosis","Death cap poisoning","Deep vein thrombosis (DVT)","Degeneration of the temporomandibular joint","Degenerative disc disease of the cervical spine","Degenerative disc disease of the lumbar and sacral spine","Degenerative disc disease of the thoracic spine","Dehydration","Dementia","Dengue fever","Dental caries","Dental pulp gangrene","Dermatomyositis","Diabetes insipidus (DI)","Diabetes mellitus type 1, type 1 diabetes, T1DM","Diabetes mellitus type 2, type 2 diabetes","Diabetic polyneuropathy, diabetic neuropathy","Disulfiram-like reaction (severe alcohol intolerance)","Diverticulitis","Diverticulosis","Dubin-Johnson syndrome","Duodenal ulcer","Echinococcosis (echinococcal disease)","Ehrlichiosis","Empty sella syndrome","Endometrial cancer","Endometriosis","Enlarged prostate","Enterobiasis (Pinworms)","Epilepsy","Erysipelas","Esophageal cancer","Esophageal diverticula","Essential thrombocytosis","Essential tremor","Extrasystoles","Eye movement nerve palsy (paralysis of the third, fourth, and sixth cranial nerves)","Facial nerve palsy (VIIth cranial nerve)","Fasciolosis, Fascioliasis, Fasciolasis, distomatosis, liver rot","Fatigue","Felon/whitlow","Food poisoning","Foot osteoarthritis","Gall bladder and bile duct cancer","Gastric cancer","Gastric ulcer","Gastritis","Gastritis due to Helicobacter pylori infection","Gastritis due to NSAID or corticosteroid use","Gastroesophageal reflux disease (GERD), Acid reflux disease","General anxiety disorder","Genital herpes","Genital warts","Gestational diabetes","Giardiasis (Beaver fever)","Gilbert's syndrome (Hereditary hyperbilirubinemia)","Gingivitis","Gitelman syndrome, familial hypokalemia-hypomagnesemia","Glaucoma","Glomerulonephritis, glomerular nephritis (GN)","Glossitis (inflammation of the tongue)","Glossopharyngeal nerve palsy (IXth cranial nerve)","Gonorrhea","Goodpasture's syndrome","Gout","Granulomatosis with polyangiitis (Wegener's granulomatosis)","Graves' disease","Guillain-Barré syndrome","Hand osteoarthritis","Hashimoto's thyroiditis (chronic lymphocytic thyroiditis)","Heat illness, Heat-related illness (Heat stroke)","Hemochromatosis","Hemolytic anemia","Hemolytic-uremic syndrome (HUS)","Hemophagocytic lymphohistiocytosis (HLH), hemophagocytic syndrome","Hemophilia A","Hemophilia B (Christmas disease)","Hemorrhagic anemia","Hemorrhoids","Henoch-Schönlein purpura","Hepatic abscess","Hepatic encephalopathy","Hepatic failure or cirrhosis","Hepatitis","Hepatitis A","Hepatitis B","Hepatitis C","Herbicide poisoning","Herpes simplex","High altitude sickness (acute mountain sickness)","Hip osteoarthritis","Hives (urticaria)","Hodgkin's lymphoma","Horner's syndrome","Hydrocele testis","Hyperandrogenism","Hyperparathyroidism","Hypertension","Hypertensive emergency, malignant hypertension","Hypertensive encephalopathy","Hyperthyroidism","Hypoglycemia","Hypoparathyroidism","Hypopituitarism","Hypotension","Hypothyroidism","Idiopathic pulmonary fibrosis","Impacted wisdom tooth","Impetigo","Improper use of sleeping pills and sedatives","Increased intracranial pressure","Infectious arthritis","Infectious diarrhea","Infectious mononucleosis","Influenza","Insulinoma","Intercostal neuralgia","Iron deficiency anemia (IDA)","Irritable bowel syndrome (IBS)","Ischemic heart disease","Joint or bone trauma","Kidney cancer","Kidney stones (renal colic)","Klüver-Bucy bitemporal syndrome","Knee osteoarthritis","Korsakoff's syndrome, Korsakoff's dementia, Amnesic-confabulatory syndrome","Laryngeal cancer","Laryngitis","Lassa fever","Latent autoimmune diabetes of adults (LADA)","Lateral medullary syndrome (Wallenberg syndrome, posterior inferior cerebellar artery syndrome)","Left frontal lobe damage","Left-sided heart failure","Legionellosis","Leriche's syndrome","Limbic encephalitis (LE)","Liver cancer","Lung cancer","Major depressive disorder","Malaria","Manic syndrome","Mastocytosis","Measles","Mediastinitis","Melanoma","Meningitis","Menopause","Methyl alcohol (methanol) poisoning","Microscopic polyangiitis","Middle cerebral artery syndrome, Middle cerebral artery stroke","Migraine","Mild Cognitive Impairment (MCI)","Milk-alkali syndrome (Burnett's syndrome)","Mixed connective tissue disease","Molar pregnancy","Mononeuritis multiplex","Mucoviscidosis (cystic fibrosis)","Multiple endocrine neoplasia type 1 (MEN1), Wermer's syndrome","Multiple endocrine neoplasia type 2A (MEN2A), Sipple's syndrome","Multiple endocrine neoplasia type 2B (MEN2B)","Multiple myeloma","Multiple sclerosis","Mumps (epidemic parotitis)","Myasthenia gravis","Myelofibrosis, Myeloid metaplasia","Myocardial infarction, Heart attack","Myocarditis","Ménière's disease","Ménétrier's disease (hyperplastic hypersecretory gastropathy)","Nasal polyps","Nephritis","Nephrotic syndrome","Nicotine dependence","No ST Elevation Myocardial Infarction","Non-Hodgkin lymphoma (NHL)","Obesity","Obsessive-compulsive disorder","Obstructive jaundice","Oculomotor nerve palsy (IIIrd cranial nerve)","Orchitis and epididymitis","Organic personality disorder","Osteomalacia","Osteoporosis","Otitis externa","Otitis internal (Labirynthitis)","Otitis media","Ovarian cancer","Paget's disease of bone","Painful menstruation (dysmenorrhea)","Pancoast tumor","Pancreatic cancer","Paradontosis","Paranoid schizophrenia","Parkinson's disease","Paronychia","Paroxysmal nocturnal hemoglobinuria","Peptic ulcer","Pericarditis","Peripheral neuropathy","Pernicious anemia, Biermer's anemia","Pesticide poisoning","Pharyngitis","Pheochromocytoma","Pituitary prolactin releasing adenoma (prolactinoma)","Pituitary somatotropin releasing tumor","Pituitary tumor","Placental site trophoblastic tumour","Plague","Platelet disorders (thrombocytopathy)","Plummer-Vinson syndrome, sideropenic dysphagia","Pneumonia","Polyarteritis nodosa","Polycystic ovary syndrome","Polycythemia vera (PV)","Polymyositis","Post-traumatic stress disorder","Postconcussional syndrome","Postpartum depression","Pre-eclampsia (gestosis)","Pregnancy","Premenstrual syndrome","Primary biliary cirrhosis (PBC)","Primary sclerosing cholangitis (PSC)","Prinzmetal's angina","Progressive supranuclear palsy (PSP), Steele-Richardson-Olszewski syndrome","Prostate cancer","Prostatitis","Pseudo-Tetany","Pseudobulbar palsy","Pseudobulbar syndrome with acute vestibulopathy","Pseudomembranous colitis","Psittacosis (parrot disease, ornithosis)","Psoriasis","Psychotic depression","Psychotic mania","Pulmonary edema","Pulmonary embolism","Pulmonary hypertension","Pulpitis","Pure hypercholesterolemia","Pure hypertriglyceridemia","Pyelonephritis","Q fever","Ramsay Hunt syndrome type II","Raynaud's phenomenon","Reactive arthritis","Recurrent laryngeal nerve paralysis","Reiter's syndrome","Relapsing fever","Respiratory failure","Retinal detachment","Retinopathy","Rheumatoid arthritis","Rift Valley fever  (RVF)","Right frontal lobe damage","Right temporal lobe damage","Right-sided heart failure","Rocky Mountain spotted fever (RMSF)","Rotor syndrome","Rubella (German measles)","ST Elevation Myocardial Infarction","Salicylate poisoning","Sarcoidosis","Scabies","Schizoaffective disorder - depressive type","Schizoaffective disorder - manic type","Sciatica","Scrub typhus (Bush typhus)","Scurvy","Seasonal affective disorder (winter depression, seasonal depression)","Seborrheic dermatitis","Sexual addiction","Shigellosis, Bacillary dysentery","Shingles","Sickle cell anemia","Sjögren's syndrome","Sleep apnea","Small intestinal bacterial overgrowth","Social anxiety disorder","Specific phobia","Spinal osteoarthritis","Streptococcal pharyngitis (strep throat)","Stress incontinence","Stye","Superficial phlebitis","Superior vena cava syndrome (SVCS)","Syndrome of inappropriate antidiuretic hormone secretion (SIADH)","Systemic lupus erythematosus (SLE)","Systemic scleroderma","Taeniasis","Takayasu's disease (Takayasu's arteritis)","Temporal giant cell arteritis (GCA)","Tension-type headaches","Testicular cancer","Testicular torsion","Tetanus","Tetany","Thoracic outlet syndrome (TOS)","Thrombotic thrombocytopenic purpura (TTP, Moschcowitz syndrome)","Thymoma","Thyreotropin releasing pituitary adenoma","Thyroid cancer","Thyrotoxicosis","Toxocariasis","Transient ischemic attack (TIA)","Trichinosis","Trichomoniasis","Trichuriasis","Trigeminal nerve damage (Vth cranial nerve)","Trigeminal neuralgia","Trochlear nerve palsy (IVth cranial nerve)","Tuberculosis","Tuberculous meningitis (TBM)","Tularemia","Tumor lysis syndrome","Type 1 Neurofibromatosis (Von Recklinghausen's Disease)","Type 2 Neurofibromatosis","Typhoid, Typhoid fever","Typhus or Epidemic typhus","Ulcerative colitis","Unilateral frontal lobe damage","Urethritis","Urge incontinence","Urinary tract infection (UTI)","Uterine cancer","Uterine fibroids","Uveitis","VIPoma, Verner-Morrison syndrome","Vaginitis","Vagus nerve palsy (Xth cranial nerve)","Vascular hemorrhagic diathesis","Vasculitis","Vertebrobasilar insufficiency","Vestibulocochlear nerve damage (VIIIth cranial nerve)","Viral meningitis","Visceral leishmaniasis (kala-azar, black fever)","Vitamin B12 deficiency anemia","Von Willebrand disease","Vulvar cancer","Vulvar cysts","Waldenström's macroglobulinemia","Warts","Water poisoning","Weil's syndrome (Leptospirosis)","Wernicke's encephalopathy","Whipple's disease","Wilson's disease","Wiskott-Aldrich syndrome","Withdrawal syndrome (sedatives)","Yellow fever","Zollinger-Ellison syndrome, gastrinoma","de Quervain's thyroiditis (subacute granulomatous thyroiditis, Giant Cell Thyroiditis)"];


function getMoreInfo(name){
	
	//calling https://wsearch.nlm.nih.gov/ws/query?db=healthTopics&term=title:<name> 
    //As CORS is not supported by this service, requesting via proxy
	$.ajax({
		type: "GET",
		url: "/conditionInfo?name="+name,

		success: function(data) {
			 var $xml = $(data),
			 text = $xml.find( "list document content[name='FullSummary']" ).first().text();
			 if(text != ""){
				 $( "#condModalBody p" ).append('<hr>');
				 $( "#condModalBody p" ).append(text);
			 }
		},
		error: function() {
		  console.log("Error connecting nih.gov");
		}
    });
}


function getConditionInfo(name){
	if(name == 'Felon/whitlow'){
		name = 'whitlow';
    }
	$.ajax({
		type: "GET",
		url: "/wikiInfo?name="+name,

		success: function(data) {
			var notSet = true;
			 if(data.query && data.query.pages){
				 var obj = null;
				 for(var key in data.query.pages) {
				   if(data.query.pages[key]["index"] == 1) {
				     obj = data.query.pages[key];
				     break;
				   }
				 }
				 if(obj && obj.extract){
					 $( "#condModalLabel" ).html(obj.title);
					 $( "#condModalBody p" ).html(obj.extract);
					 if(obj.thumbnail && obj.thumbnail.source){
						 $( "#condModalBody img" ).attr("src", obj.thumbnail.source);
					 }
					 notSet = false;
					 getMoreInfo(name);
				 }
			 }
			 if(notSet){
				 $( "#condModalLabel" ).html(name);
				 $( "#condModalBody p" ).html("No details found.");
			 }
			 $("#condModal").show();
			 
		},
		error: function() {
		  console.log("Error connecting wikipedia");
		  $( "#condModalLabel" ).html(name);
		  $( "#condModalBody p" ).html("Error finding details.");
		  $("#condModal").show();
		}
    });
}


$(document).ready(function() {
	var substringMatcher = function(strs) {
	  return function findMatches(q, cb) {
	    var matches, substrRegex;

	    // an array that will be populated with substring matches
	    matches = [];

	    // regex used to determine if a string contains the substring `q`
	    substrRegex = new RegExp(q, 'i');

	    // iterate through the pool of strings and for any string that
	    // contains the substring `q`, add it to the `matches` array
	    $.each(strs, function(i, str) {
	      if (substrRegex.test(str)) {
	        matches.push(str);
	      }
	    });

	    cb(matches);
	  };
	};

	$('#searchinput').typeahead({
		  hint: false,
		  highlight: true,
		  minLength: 1
		},
		{
		  name: 'conditions',
		  source: substringMatcher(conditions)
		}
	);
	
	//Listen to a typeahead event for suggestion selection and capture the symptom Id
	$('#searchinput').bind('typeahead:select', function(ev, suggestion) {
		$( "#condModalBody img" ).attr("src", "");
		$("#condModal").hide();
		getConditionInfo(suggestion);
	});
	
	
});

